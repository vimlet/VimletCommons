<%
function treeLink(file, isFirst){
  var url = file.url.replace(/[/\\*]/g, "/");
  if(data.isMdConverted){
    url = "lib/" + url;
  }
  url+=".html"
  if(isFirst){
    echo('<div class="treeLink treeSelected" link="' + url + '" onclick="treeLink(this.getAttribute(&quot;link&quot;)); treeSelected(this)">' + file.url + '</div>');
  }else{
    echo('<div class="treeLink" link="' + url + '" onclick="treeLink(this.getAttribute(&quot;link&quot;)); treeSelected(this)">' + file.url + '</div>');
  }
}
%>
  <!DOCTYPE html>
  <html>

  <head>
    <meta charset="utf-8"
         name="viewport"
         content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet"
         href="index.css"> </head>


  <body>

    <div id="container">
      <div id="tree">
        <input class="searchInput"
             id="treeSearch"
             type="search"
             placeholder="Search"
             onsearch="search(this.value);"
             onkeyup="search(this.value);">
        <div id="treeData">
          <%
          var isFirst = true;
          data.files.forEach(function(file){
            treeLink(file, isFirst);
            isFirst = false;
          });
          %>
        </div>
        <div id=hideTreeButton onclick="document.querySelector('#tree').classList.toggle('showTreeMobile');">></div>
      </div>
      <div id="explorer">
        <%
        var tmpUrl = '';
        if(data.files.length > 0){
        if(!data.isMdConverted){
          tmpUrl = "'" + data.files[0].url + ".html'";
        }else{
          tmpUrl = "'lib/" + data.files[0].url + ".html'";
        }
        }
          echo('<iframe id="explorerIframe" src=' + tmpUrl + '></iframe>');
        %>
      </div>
    </div>

    <script>
      function treeLink(url) {
        document.querySelector("#explorerIframe").setAttribute("src", url);
      }

      function treeSelected(element) {
        var elements = document.querySelectorAll(".treeLink");
        elements.forEach(function(elem) {
          elem.classList.remove("treeSelected");
        });
        element.classList.add("treeSelected");
      }

      function search(value) {
        val = value.toLowerCase().toLowerCase();
        var elements = document.querySelectorAll(".treeLink");
        elements.forEach(function(elem) {
          elem.classList.remove("menuSearchHide");
          if (elem.innerHTML.toLowerCase().indexOf(val) === -1) {
            elem.classList.add("menuSearchHide")
          }
        });
      }


      /* Detect click for closing menus */
      document.onclick = function(event) {
        if (event === undefined) event = window.event;
        var target = 'target' in event ? event.target : event.srcElement;
      };
    </script>

  </body>

  </html>
